<?xml version="1.0" encoding="UTF-8"?>
<odoo>

    <!--
        VISTA DE LISTA DE CITAS
        Muestra todas las citas creadas
    -->
    <record id="view_peluqueria_cita_list" model="ir.ui.view">
        <field name="name">peluqueria.cita.list</field>
        <field name="model">peluqueria.cita</field>
        <field name="arch" type="xml">
            <list>
                <field name="fecha_inicio"/>
                <field name="fecha_fin"/>
                <field name="cliente_id"/>
                <field name="estilista_id"/>
                <field name="state"/>
                <field name="total"/>
            </list>
        </field>
    </record>

    <!--
        VISTA DE FORMULARIO DE CITAS
        Permite crear y editar una cita
    -->
    <record id="view_peluqueria_cita_form" model="ir.ui.view">
        <field name="name">peluqueria.cita.form</field>
        <field name="model">peluqueria.cita</field>
        <field name="arch" type="xml">
            <form>

                <!--
                BOTONES DE ESTADO
                Se muestran u ocultan según el estado actual de la cita
                -->
                <header>

                    <!--
                        Botón Confirmar
                        Solo visible cuando la cita está en borrador
                    -->
                    <button
                        name="action_confirmar"
                        type="object"
                        string="Confirmar"
                        class="btn-primary"
                        invisible="state != 'borrador'"
                    />

                    <!--
                        Botón Finalizar
                        Solo visible cuando la cita está confirmada
                    -->
                    <button
                        name="action_realizar"
                        type="object"
                        string="Finalizar"
                        class="btn-success"
                        invisible="state != 'confirmada'"
                    />

                    <!--
                        Botón Cancelar
                        Visible en borrador o confirmada
                    -->
                    <button
                        name="action_cancelar"
                        type="object"
                        string="Cancelar"
                        class="btn-danger"
                        invisible="state not in ('borrador', 'confirmada')"
                    />

                    <!--
                        Botón Volver a borrador
                        Solo visible si la cita está cancelada
                    -->
                    <button
                        name="action_volver_borrador"
                        type="object"
                        string="Volver a borrador"
                        invisible="state in ('borrador')"
                    />

                    <!--
                        Barra visual del estado de la cita
                    -->
                    <field
                        name="state"
                        widget="statusbar"
                        statusbar_visible="borrador,confirmada,realizada,cancelada"
                    />

                </header>



                <sheet>

                    <!-- Código automático de la cita: De momento lo comento
                    porque con que aparezca una vez sobra. Ya lo he puesto en el
                    name para que sustituya lo que se mostraba antes que era el
                    identificador interno de la BBDD y eso no tiene ningún sentido -->
                    <!-- <group>
                        <field name="name" readonly="1"/>
                    </group> -->

                    <!-- Datos principales de la cita -->
                    <group>
                        <field name="cliente_id"/>
                        <field name="estilista_id"/>
                        <field name="fecha_inicio"/>
                        <field name="fecha_fin" readonly="1"/>
                        <field name="state"/>
                    </group>

                    <!-- Líneas de servicios -->
                    <notebook>
                        <page string="Servicios">
                            <field name="linea_servicio_ids">
                                <list editable="bottom">
                                    <field name="servicio_id" width="300"/>
                                    <field name="duracion"/>
                                    <field name="precio"/>
                                    <field name="subtotal" readonly="1"/>
                                </list>
                            </field>
                        </page>
                    </notebook>

                    <!-- Total de la cita -->
                    <group>
                        <field name="total" readonly="1"/>
                    </group>

                </sheet>
            </form>
        </field>
    </record>

    <!--
        ACCIÓN DE CITAS
        Es la que usa el menú Gestiones → Citas
    -->
    <record id="action_peluqueria_cita" model="ir.actions.act_window">
        <field name="name">Citas</field>
        <field name="res_model">peluqueria.cita</field>
        <field name="view_mode">list,form</field>
    </record>

</odoo>
